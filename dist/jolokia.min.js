/**
 * Jolokia JavaScript client library
 *
 * Version 0.1.5
 *
 * GitHub repository can be found at https://github.com/janjakubnanista/jolokia-js-client
 *
 * Released under MIT license
 *
 * Created by Ján Jakub Naništa <jan.jakub.nanista@gmail.com>
 */
var Poller=function(){"use strict";function a(a){return"jolokia-job-"+a}var b=function(b){var c=!1,d=-1,e=null,f=0,g={};this._register=function(b){var c=a(++f);return g[c]=b,c},this._unregister=function(a){if(!g[a])throw"Invalid job ID: "+a;delete g[a]},this._clear=function(){g={}},this._start=function(a){if(c){if(d===a)return;this._stop()}d=a,c=!0,e=setInterval(function(){for(var a in g)b.request(g[a].request,g[a].options)},d)},this._stop=function(){c&&clearInterval(e)},this.interval=function(){return d},this.isRunning=function(){return c}};return b.prototype.register=function(a,b){"function"==typeof b&&(b={success:b});var c={options:b,request:a},d=this._register(c);return d},b.prototype.unregister=function(a){return this._unregister(a),this},b.prototype.clear=function(){return this._clear(),this},b.prototype.start=function(a){return this._start(a),this},b.prototype.stop=function(){return this._stop(),this},b}(),Jolokia=function(a){"use strict";function b(b){return 200!==b[0].status?a.Deferred().reject(b[0]):b[0].value}function c(a){return null===a||void 0===a?"[null]":""===a?'""':a.toString()}function d(a,b){var c={};return b.forEach(function(b){a[b]&&(c[b]=a[b])}),c}function e(a,b){var c=[];for(var d in b)c.push(d+"="+b[d]);return c=c.join("&"),c&&(a=-1===a.indexOf("?")?a+"?"+c:a.replace("?","?"+c+"&")),a}var f=["maxDepth","maxCollectionSize","maxObjects","ignoreErrors","canonicalNaming","serializeException","includeStackTrace","ifModifiedSince"],g=function(b){"string"==typeof b&&(b={url:b}),b=a.extend({},b),this.options=function(){return 0===arguments.length?a.extend({},b):(b=a.extend(b,arguments[0]),void 0)};var c=new Poller(this);this.poller=function(){return c}};return g.escape=function(a){return encodeURIComponent(a.replace(/[!\/]/,"!$1"))},g.isError=function(a){return!a.status||200!==a.status},g.toString=function(b){return a.isArray(b)?b.map(c).join(","):c(b)},g.prototype.determineRequestMethod=function(b){var c=a.isArray(b)||b.config||b.type.match(/read/i)&&a.isArray(b.attribute)||b.target?"post":"get";return c},g.prototype.constructUrl=function(b){var c=b.type.toLowerCase(),d=[],e="";return"read"===c?b.attribute?(d=[b.mbean,b.attribute],e=b.path):d=[b.mbean]:"write"===c?(d=[b.mbean,b.attribute,g.toString(b.value)],e=b.path):"exec"===c?(d=[b.mbean,b.operation],b.arguments&&(d=d.concat(b.arguments.map(g.toString)))):"search"===c?d=[b.mbean]:"list"===c&&(e=b.path),a.isArray(e)&&(e=e.map(g.escape).join("/")),d.unshift(c),d=d.map(g.escape),e=e?e.replace(/^\//,""):"",d.join("/")+"/"+e},g.prototype.request=function(b,c){if(c=a.extend({},this.options(),c),!c.url||"string"!=typeof c.url)throw"Invalid URL : "+c.url;var g=(c.method&&"auto"!==c.method?c.method:this.determineRequestMethod(b)).toLowerCase();if("get"!==g&&"post"!==g)throw new Error("Unsupported request method: "+g);if("post"===g){if(c.jsonp)throw new Error("Can not use JSONP with POST requests")}else{if(a.isArray(b))throw new Error("Cannot use GET with bulk requests");if(b.type.match(/read/i)&&a.isArray(b.attribute))throw new Error("Cannot use GET for read with multiple attributes");if(b.target)throw new Error("Cannot use GET request with proxy mode");if(b.config)throw new Error("Cannot use GET with request specific config")}var h={};if(c.username&&c.password){if("function"==typeof window.btoa){var i=c.username+":"+c.password;h.headers={Authorization:"Basic "+window.btoa(i)}}h.xhrFields={withCredentials:!0}}c.timeout&&(h.timeout=c.timeout),c.url=c.url.replace(/\/*$/,"/");var j=d(c,f);return c.url=e(c.url,j),"get"===g?c.url+=this.constructUrl(b,c):h.data=JSON.stringify(b),h.type=g,h.url=c.url,h.processData=!1,h.dataType=c.jsonp?"jsonp":"json",h.headers=a.extend({},h.headers,c.headers),a.ajax(h).then(function(b){var d=a.isArray(b)?b:[b];return"function"==typeof c.success&&c.success.call(this,d),d}.bind(this),c.error)},g.prototype.get=function(c,d,e,f){3===arguments.length&&a.isPlainObject(e)?(f=e,e=null):2===arguments.length&&a.isPlainObject(d)&&(f=d,d=null,e=null);var g={type:"read",mbean:c,attribute:d};return e&&(g.path=e),this.request(g,f).then(b)},g.prototype.set=function(c,d,e,f,g){4===arguments.length&&a.isPlainObject(f)&&(g=f,f=null);var h={type:"write",mbean:c,attribute:d,value:e};return f&&(h.path=f),this.request(h,g).then(b)},g.prototype.execute=function(c,d){var e,f={type:"exec",mbean:c,operation:d},g=Array.prototype.slice.call(arguments,0);return g.length>2&&a.isPlainObject(g[g.length-1])&&(e=g.pop()),g.length>2&&(f.arguments=g.slice(2)),this.request(f,e).then(b)},g.prototype.search=function(a,c){var d={type:"search",mbean:a};return this.request(d,c).then(b)},g.prototype.version=function(a){return this.request({type:"version"},a).then(b)},g.prototype.list=function(c,d){1===arguments.length&&!a.isArray(c)&&a.isPlainObject(c)&&(d=c,c=null);var e={type:"list"};return c&&(e.path=c),this.request(e,d).then(b)},g.prototype.register=function(a,b){return this.poller().register(a,b)},g.prototype.unregister=function(a){return this.poller().unregister(a)},g.prototype.start=function(a){return this.poller().start(a||this.options().interval)},g.prototype.stop=function(){return this.poller().stop()},g}(jQuery);window.Jolokia=Jolokia;